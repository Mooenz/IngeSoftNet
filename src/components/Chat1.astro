---
interface Props {
	classIcon: string;
	tooltipClass: string;
}

const { classIcon, tooltipClass } = Astro.props;
---

<button class={`${classIcon} bg-gray-500 text-white cursor-pointer`} aria-label="Inicia un chat" id="open-chat-widget" type="button">
	<i class="fi fi-rr-user-headset text-xl lg:text-3xl justify-center"></i>
	<span class={tooltipClass}>Inicia un chat</span>
</button>

<div class="chat-overlay" id="chat-overlay" aria-hidden="true">
	<section class="chat-modal" role="dialog" aria-modal="true" aria-labelledby="chat-modal-title">
		<div class="flex items-center justify-between p-4">
			<p class="text-xl font-bold pl-2" id="chat-modal-title">Inicia un chat</p>
			<button class="cursor-pointer flex items-center justify-center h-10 w-10 bg-gray-200 hover:bg-gray-400 text-white rounded-full transition-all duration-300 ease-in-out" aria-label="Cerrar chat" id="close-chat-widget" type="button">
				<i class="fi fi-rr-cross-small"></i>
			</button>
		</div>

		<iframe src="https://server402.islonline.net/live/islpronto/start.html?_s=1&template=dn%3aingesoftnet" class="flex-1 w-full" title="Chat en vivo con un asesor"></iframe>
	</section>
</div>

<script>
	const chatOverlay = document.getElementById('chat-overlay');
	const openChatWidget = document.getElementById('open-chat-widget');
	const closeChatWidget = document.getElementById('close-chat-widget');

	const openModal = () => {
		chatOverlay.classList.add('activo');
		chatOverlay.setAttribute('aria-hidden', 'false');
	};

	const closeModal = () => {
		chatOverlay.classList.remove('activo');
		chatOverlay.setAttribute('aria-hidden', 'true');
	};

	openChatWidget.addEventListener('click', openModal);
	closeChatWidget.addEventListener('click', closeModal);

	chatOverlay.addEventListener('click', (event) => {
		if (event.target === chatOverlay) {
			closeModal();
		}
	});

	document.addEventListener('keydown', (event) => {
		if (event.key === 'Escape' && chatOverlay.classList.contains('activo')) {
			closeModal();
		}
	});
</script>

<style>
	.chat-overlay {
		position: fixed;
		inset: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		background: rgba(0, 0, 0, 0.6);
		z-index: 50;
		padding: 1rem;
		opacity: 0;
		visibility: hidden;
		pointer-events: none;
		transition: opacity 0.3s ease;
	}

	.chat-overlay.activo {
		opacity: 1;
		visibility: visible;
		pointer-events: auto;
	}

	.chat-modal {
		width: 100%;
		max-width: 1280px;
		height: 100%;
		background: #fff;
		border-radius: 1.5rem;
		box-shadow: 0 10px 35px rgba(0, 0, 0, 0.2);
		display: flex;
		flex-direction: column;
		overflow: hidden;
		transform: translateY(20px) scale(0.95);
		opacity: 0;
		transition:
			transform 0.35s ease,
			opacity 0.35s ease;
	}

	.chat-overlay.activo .chat-modal {
		transform: translateY(0) scale(1);
		opacity: 1;
	}

	@media (min-width: 768px) {
		.chat-modal {
			max-height: 90%;
		}
	}
</style>
